<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Price Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="container">
    <nav>
        <ul><li><strong>üè° Corbin's Home Tracker</strong></li></ul>
        <ul><li>Lincoln (95661) vs Westchester (90045)</li></ul>
    </nav>

    <main>
        <div class="grid">
            <article>
                <header>Roseville (95661)</header>
                <h2 id="price1" style="color: #36A2EB;">Loading...</h2>
            </article>
            <article>
                <header>Westchester (90045)</header>
                <h2 id="price2" style="color: #FF9F40;">Loading...</h2>
            </article>
        </div>

        <article>
            <canvas id="priceChart" style="width:100%; height:450px;"></canvas>
        </article>
    </main>

    <script>
        // YOUR DIRECT CSV LINKS
        const csvRoseville = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxrQGCdj2JPKoy5VRkBbECutZj3DMHGH-WhwH1MOxysR29ltTzOCjm37RYZ-7uPtdqVoSHV1xGJaxi/pub?gid=0&single=true&output=csv';
        const csvWestchester = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTxrQGCdj2JPKoy5VRkBbECutZj3DMHGH-WhwH1MOxysR29ltTzOCjm37RYZ-7uPtdqVoSHV1xGJaxi/pub?gid=1133081420&single=true&output=csv';

        async function parseCSV(url) {
            const resp = await fetch(url);
            const text = await resp.text();
            // Split rows, skip the header row [Date, Price]
            const rows = text.trim().split('\n').slice(1);
            return rows.map(row => {
                const [date, price] = row.split(',');
                return { x: date.trim(), y: parseFloat(price) };
            }).filter(d => !isNaN(d.y));
        }

        async function render() {
            const dataRose = await parseCSV(csvRoseville);
            const dataWest = await parseCSV(csvWestchester);

            // Update Header Values with latest price entries
            if (dataRose.length > 0) document.getElementById('price1').innerText = `$${dataRose[dataRose.length - 1].y.toLocaleString()}`;
            if (dataWest.length > 0) document.getElementById('price2').innerText = `$${dataWest[dataWest.length - 1].y.toLocaleString()}`;

            const ctx = document.getElementById('priceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Roseville (95661)',
                            data: dataRose,
                            borderColor: '#36A2EB',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            borderWidth: 3,
                            fill: true
                        },
                        {
                            label: 'Westchester (90045)',
                            data: dataWest,
                            borderColor: '#FF9F40',
                            backgroundColor: 'rgba(255, 159, 64, 0.1)',
                            borderWidth: 3,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'category', title: { display: true, text: 'Date' } },
                        y: { 
                            title: { display: true, text: 'Price ($)' },
                            ticks: { callback: (value) => '$' + value.toLocaleString() }
                        }
                    },
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }

        render();
    </script>
</body>
</html>
